#!/usr/bin/env bash

news="$HOME/.config/.news"

$HOME/bin/config master fetch
$HOME/bin/config merge --ff-only origin/master

if [ $? -ne 0 ]; then
	$HOME/bin/config rebase origin/master

	if [ $? -ne 0 ]; then
		cat <<-EOF >>$news
			From Auto-generated by config
			From: config <config@localhost>
			To: You
			Subject: Sync Dot-Dir requires manual intervention

			Failed to FF merge and failed to rebase local
			changes to master when syncing config to origin
			on $(date +%Y%m%d-%H:%M:%S)

		EOF
		exit
	fi
fi

$HOME/bin/config master push
